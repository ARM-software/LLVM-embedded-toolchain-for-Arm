From 763821bc0f57ad93e741d64b98c09d5fef596104 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Dominik=20W=C3=B3jt?= <dominik.wojt@arm.com>
Date: Wed, 15 Nov 2023 12:18:35 +0100
Subject: disable large tests

---
 libcxx/test/configs/armv7m-picolibc-libc++.cfg.in       | 2 ++
 libcxxabi/test/configs/armv7m-picolibc-libc++abi.cfg.in | 3 +++
 libcxxabi/test/test_demangle.pass.cpp                   | 2 +-
 libunwind/test/configs/armv7m-picolibc-libunwind.cfg.in | 3 +++
 4 files changed, 9 insertions(+), 1 deletion(-)

diff --git a/libcxx/test/configs/armv7m-picolibc-libc++.cfg.in b/libcxx/test/configs/armv7m-picolibc-libc++.cfg.in
index 14526c007924..840e218dff3d 100644
--- a/libcxx/test/configs/armv7m-picolibc-libc++.cfg.in
+++ b/libcxx/test/configs/armv7m-picolibc-libc++.cfg.in
@@ -39,6 +39,8 @@ config.substitutions.append(('%{exec}',
 
 # Long tests are prohibitively slow when run via emulation.
 config.long_tests = False
+# The emulated target has limited memory.
+config.large_tests = False
 
 import os, site
 site.addsitedir(os.path.join('@LIBCXX_SOURCE_DIR@', 'utils'))
diff --git a/libcxxabi/test/configs/armv7m-picolibc-libc++abi.cfg.in b/libcxxabi/test/configs/armv7m-picolibc-libc++abi.cfg.in
index b4744f935ad8..52aae63e82d6 100644
--- a/libcxxabi/test/configs/armv7m-picolibc-libc++abi.cfg.in
+++ b/libcxxabi/test/configs/armv7m-picolibc-libc++abi.cfg.in
@@ -28,6 +28,9 @@ config.substitutions.append(('%{exec}',
     ' --execdir %T'
 ))
 
+# The emulated target has limited memory.
+config.large_tests = False
+
 import os, site
 site.addsitedir(os.path.join('@LIBCXXABI_LIBCXX_PATH@', 'utils'))
 import libcxx.test.params, libcxx.test.config
diff --git a/libcxxabi/test/test_demangle.pass.cpp b/libcxxabi/test/test_demangle.pass.cpp
index 2b4e2011498d..25eb6f254f66 100644
--- a/libcxxabi/test/test_demangle.pass.cpp
+++ b/libcxxabi/test/test_demangle.pass.cpp
@@ -10,7 +10,7 @@
 // XFAIL: stdlib=apple-libc++ && target={{.+}}-apple-macosx10.{{9|10|11|12|13|14|15}}
 
 // This test is too big for most embedded devices.
-// XFAIL: LIBCXX-PICOLIBC-FIXME
+// REQUIRES: large_tests
 
 // https://llvm.org/PR51407 was not fixed in some previously-released
 // demanglers, which causes them to run into the infinite loop.
diff --git a/libunwind/test/configs/armv7m-picolibc-libunwind.cfg.in b/libunwind/test/configs/armv7m-picolibc-libunwind.cfg.in
index e8f68a51fc53..55b8ce11d06f 100644
--- a/libunwind/test/configs/armv7m-picolibc-libunwind.cfg.in
+++ b/libunwind/test/configs/armv7m-picolibc-libunwind.cfg.in
@@ -28,6 +28,9 @@ config.substitutions.append(('%{exec}',
     ' --execdir %T'
 ))
 
+# The emulated target has limited memory.
+config.large_tests = False
+
 import os, site
 site.addsitedir(os.path.join('@LIBUNWIND_LIBCXX_PATH@', 'utils'))
 import libcxx.test.params, libcxx.test.config
-- 
2.34.1

